var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(l,u,q){l instanceof String&&(l=String(l));for(var B=l.length,z=0;z<B;z++){var G=l[z];if(u.call(q,G,z,l))return{i:z,v:G}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,u,q){l!=Array.prototype&&l!=Object.prototype&&(l[u]=q.value)};$jscomp.getGlobal=function(l){l=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,l];for(var u=0;u<l.length;++u){var q=l[u];if(q&&q.Math==Math)return q}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(l,u,q,B){if(u){q=$jscomp.global;l=l.split(".");for(B=0;B<l.length-1;B++){var z=l[B];z in q||(q[z]={});q=q[z]}l=l[l.length-1];B=q[l];u=u(B);u!=B&&null!=u&&$jscomp.defineProperty(q,l,{configurable:!0,writable:!0,value:u})}};$jscomp.polyfill("Array.prototype.find",function(l){return l?l:function(l,q){return $jscomp.findInternal(this,l,q).v}},"es6","es3");
(function(l,u){"object"===typeof exports?module.exports=u():"function"===typeof define&&define.amd?define([],u):(l.org=l.org||{},l.org.cometd=u())})(this,function(){function l(){var d={};self.onmessage=function(e){var b=e.data;e=d[b.id];switch(b.type){case "setTimeout":d[b.id]=self.setTimeout(function(){delete d[b.id];self.postMessage({id:b.id})},b.delay);break;case "clearTimeout":delete d[b.id];e&&self.clearTimeout(e);break;default:throw"Unknown command "+b.type;}}}var u=function(){var d=0,e={};
this.register=function(b){var f=++d;e[f]=b;return f};this.unregister=function(b){var f=e[b];delete e[b];return f};this.setTimeout=function(b,f){return window.setTimeout(b,f)};this.clearTimeout=function(b){window.clearTimeout(b)}},q={isString:function(d){return void 0===d||null===d?!1:"string"===typeof d||d instanceof String},isArray:function(d){return void 0===d||null===d?!1:d instanceof Array},inArray:function(d,e){for(var b=0;b<e.length;++b)if(d===e[b])return b;return-1}},B=function(){var d=[],
e={};this.getTransportTypes=function(){return d.slice(0)};this.findTransportTypes=function(b,f,A){for(var c=[],g=0;g<d.length;++g){var h=d[g];!0===e[h].accept(b,f,A)&&c.push(h)}return c};this.negotiateTransport=function(b,f,A,c){for(var g=0;g<d.length;++g)for(var h=d[g],n=0;n<b.length;++n)if(h===b[n]){var x=e[h];if(!0===x.accept(f,A,c))return x}return null};this.add=function(b,f,A){for(var c=!1,g=0;g<d.length;++g)if(d[g]===b){c=!0;break}c||("number"!==typeof A?d.push(b):d.splice(A,0,b),e[b]=f);return!c};
this.find=function(b){for(var f=0;f<d.length;++f)if(d[f]===b)return e[b];return null};this.remove=function(b){for(var f=0;f<d.length;++f)if(d[f]===b)return d.splice(f,1),f=e[b],delete e[b],f;return null};this.clear=function(){d=[];e={}};this.reset=function(b){for(var f=0;f<d.length;++f)e[d[f]].reset(b)}},z=function(){var d,e,b;this.registered=function(b,A){d=b;e=A};this.unregistered=function(){e=d=null};this._debug=function(){e._debug.apply(e,arguments)};this._mixin=function(){return e._mixin.apply(e,
arguments)};this.getConfiguration=function(){return e.getConfiguration()};this.getAdvice=function(){return e.getAdvice()};this.setTimeout=function(b,d){return e.setTimeout(b,d)};this.clearTimeout=function(b){e.clearTimeout(b)};this.convertToMessages=function(b){if(q.isString(b))try{return JSON.parse(b)}catch(A){throw this._debug("Could not convert to JSON the following string",'"'+b+'"'),A;}if(q.isArray(b))return b;if(void 0===b||null===b)return[];if(b instanceof Object)return[b];throw"Conversion Error "+
b+", typeof "+typeof b;};this.accept=function(b,d,c){throw"Abstract";};this.getType=function(){return d};this.getURL=function(){return b};this.setURL=function(f){b=f};this.send=function(b,d){throw"Abstract";};this.reset=function(b){this._debug("Transport",d,"reset",b?"initial":"retry")};this.abort=function(){this._debug("Transport",d,"aborted")};this.toString=function(){return this.getType()}};z.derive=function(d){function e(){}e.prototype=d;return new e};var G=function(){function d(b){for(;0<x.length;){var c=
x[0],m=c[0];c=c[1];if(m.url===b.url&&m.sync===b.sync)x.shift(),b.messages=b.messages.concat(m.messages),this._debug("Coalesced",m.messages.length,"messages from request",c.id);else break}}function e(b,c){this.transportSend(b,c);c.expired=!1;if(!b.sync){var m=this.getConfiguration().maxNetworkDelay,d=m;!0===c.metaConnect&&(d+=this.getAdvice().timeout);this._debug("Transport",this.getType(),"waiting at most",d,"ms for the response, maxNetworkDelay",m);var f=this;c.timeout=this.setTimeout(function(){c.expired=
!0;var r="Request "+c.id+" of transport "+f.getType()+" exceeded "+d+" ms max network delay",m={reason:r},g=c.xhr;m.httpCode=f.xhrStatus(g);f.abortXHR(g);f._debug(r);f.complete(c,!1,c.metaConnect);b.onFailure(g,b.messages,m)},d)}}function b(b){var c=++g,m={id:c,metaConnect:!1,envelope:b};n.length<this.getConfiguration().maxConnections-1?(n.push(m),e.call(this,b,m)):(this._debug("Transport",this.getType(),"queueing request",c,"envelope",b),x.push([b,m]))}function f(c,f){var m=q.inArray(c,n);0<=m&&
n.splice(m,1);if(0<x.length){m=x.shift();var g=m[0],e=m[1];this._debug("Transport dequeued request",e.id);if(f)this.getConfiguration().autoBatch&&d.call(this,g),b.call(this,g),this._debug("Transport completed request",c.id,g);else{var r=this;this.setTimeout(function(){r.complete(e,!1,e.metaConnect);var b={reason:"Previous request failed"},c=e.xhr;b.httpCode=r.xhrStatus(c);g.onFailure(c,g.messages,b)},0)}}}var A=new z,c=z.derive(A),g=0,h=null,n=[],x=[];c.complete=function(b,c,d){if(d){b=b.id;this._debug("Transport",
this.getType(),"/meta/connect complete, request",b);if(null!==h&&h.id!==b)throw"/meta/connect request mismatch, completing request "+b;h=null}else f.call(this,b,c)};c.transportSend=function(b,c){throw"Abstract";};c.transportSuccess=function(b,c,d){if(!c.expired)if(this.clearTimeout(c.timeout),this.complete(c,!0,c.metaConnect),d&&0<d.length)b.onSuccess(d);else b.onFailure(c.xhr,b.messages,{httpCode:204})};c.transportFailure=function(b,c,d){c.expired||(this.clearTimeout(c.timeout),this.complete(c,!1,
c.metaConnect),b.onFailure(c.xhr,b.messages,d))};c.send=function(c,d){if(d){if(null!==h)throw"Concurrent /meta/connect requests not allowed, request id="+h.id+" not yet completed";d=++g;this._debug("Transport",this.getType(),"/meta/connect send, request",d,"envelope",c);d={id:d,metaConnect:!0,envelope:c};e.call(this,c,d);h=d}else b.call(this,c)};c.abort=function(){A.abort();for(var b=0;b<n.length;++b){var c=n[b];c&&(this._debug("Aborting request",c),this.abortXHR(c.xhr)||this.transportFailure(c.envelope,
c,{reason:"abort"}))}if(b=h)this._debug("Aborting /meta/connect request",b),this.abortXHR(b.xhr)||this.transportFailure(b.envelope,b,{reason:"abort"});this.reset(!0)};c.reset=function(b){A.reset(b);h=null;n=[];x=[]};c.abortXHR=function(b){if(b)try{var c=b.readyState;b.abort();return c!==window.XMLHttpRequest.UNSENT}catch(Ga){this._debug(Ga)}return!1};c.xhrStatus=function(b){if(b)try{return b.status}catch(t){this._debug(t)}return-1};return c},oa=function(){function d(d){try{d.context=b.context}catch(c){this._debug("Could not copy transport context into XHR",
c)}}var e=new G,b=z.derive(e),f=!0;b.accept=function(b,c,d){return f||!c};b.newXMLHttpRequest=function(){return new window.XMLHttpRequest};b.xhrSend=function(f){var c=b.newXMLHttpRequest();d(c);c.withCredentials=!0;c.open("POST",f.url,!0!==f.sync);var g=f.headers;if(g)for(var e in g)g.hasOwnProperty(e)&&c.setRequestHeader(e,g[e]);c.setRequestHeader("Content-Type","application/json;charset=UTF-8");c.onload=function(){if(200===c.status)f.onSuccess(c.responseText);else f.onError(c.statusText)};c.onabort=
c.onerror=function(){f.onError(c.statusText)};c.send(f.body);return c};b.transportSend=function(b,c){this._debug("Transport",this.getType(),"sending request",c.id,"envelope",b);var d=this;try{var e=!0;c.xhr=this.xhrSend({transport:this,url:b.url,sync:b.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(b.messages),onSuccess:function(e){d._debug("Transport",d.getType(),"received response",e);var g=!1;try{var h=d.convertToMessages(e);0===h.length?(f=!1,d.transportFailure(b,c,{httpCode:204})):
(g=!0,d.transportSuccess(b,c,h))}catch(t){d._debug(t),g||(f=!1,e={exception:t},e.httpCode=d.xhrStatus(c.xhr),d.transportFailure(b,c,e))}},onError:function(g,h){d._debug("Transport",d.getType(),"received error",g,h);f=!1;var m={reason:g,exception:h};m.httpCode=d.xhrStatus(c.xhr);e?d.setTimeout(function(){d.transportFailure(b,c,m)},0):d.transportFailure(b,c,m)}});e=!1}catch(n){f=!1,this.setTimeout(function(){d.transportFailure(b,c,{exception:n})},0)}};b.reset=function(b){e.reset(b);f=!0};return b},
pa=function(){function d(b,d,c){var f=this;return function(){f.transportFailure(b,d,"error",c)}}var e=new G;e=z.derive(e);var b=0;e.accept=function(b,d,c){return!0};e.jsonpSend=function(d){var e=document.getElementsByTagName("head")[0],c=document.createElement("script"),f="_cometd_jsonp_"+b++;window[f]=function(b){e.removeChild(c);delete window[f];d.onSuccess(b)};var h=d.url;h+=0>h.indexOf("?")?"?":"&";h=h+("jsonp="+f)+("&message="+encodeURIComponent(d.body));c.src=h;c.async=!0!==d.sync;c.type="application/javascript";
c.onerror=function(b){d.onError("jsonp "+b.type)};e.appendChild(c)};e.transportSend=function(b,e){for(var c=this,f=0,h=b.messages.length,n=[];0<h;){var l=JSON.stringify(b.messages.slice(f,f+h));l=b.url.length+encodeURI(l).length;var m=this.getConfiguration().maxURILength;if(l>m){if(1===h){n="Bayeux message too big ("+l+" bytes, max is "+m+") for transport "+this.getType();this.setTimeout(d.call(this,b,e,n),0);return}--h}else n.push(h),f+=h,h=b.messages.length-f}var t=b;if(1<n.length)for(f=0,h=n[0],
this._debug("Transport",this.getType(),"split",b.messages.length,"messages into",n.join(" + ")),t=this._mixin(!1,{},b),t.messages=b.messages.slice(f,h),t.onSuccess=b.onSuccess,t.onFailure=b.onFailure,l=1;l<n.length;++l)m=this._mixin(!1,{},b),f=h,h+=n[l],m.messages=b.messages.slice(f,h),m.onSuccess=b.onSuccess,m.onFailure=b.onFailure,this.send(m,e.metaConnect);this._debug("Transport",this.getType(),"sending request",e.id,"envelope",t);try{var q=!0;this.jsonpSend({transport:this,url:t.url,sync:t.sync,
headers:this.getConfiguration().requestHeaders,body:JSON.stringify(t.messages),onSuccess:function(b){var d=!1;try{var r=c.convertToMessages(b);0===r.length?c.transportFailure(t,e,{httpCode:204}):(d=!0,c.transportSuccess(t,e,r))}catch(L){c._debug(L),d||c.transportFailure(t,e,{exception:L})}},onError:function(b,d){var r={reason:b,exception:d};q?c.setTimeout(function(){c.transportFailure(t,e,r)},0):c.transportFailure(t,e,r)}});q=!1}catch(Ha){this.setTimeout(function(){c.transportFailure(t,e,{exception:Ha})},
0)}};return e},sa=function(){function d(b,c){b&&(this.webSocketClose(b,c.code,c.reason),this.onClose(b,c))}function e(b,c,d){for(var e=[],r=0;r<c.messages.length;++r){var f=c.messages[r];f.id&&e.push(f.id)}b.envelopes[e.join(",")]=[c,d];this._debug("Transport",this.getType(),"stored envelope, envelopes",b.envelopes)}function b(b){if(!u){var c=h.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",c);try{var e=h.getConfiguration().protocol;b.webSocket=e?new window.WebSocket(c,
e):new window.WebSocket(c);u=b}catch(M){throw n=!1,this._debug("Exception while creating WebSocket object",M),M;}m=!1!==h.getConfiguration().stickyReconnect;var f=this,r=h.getConfiguration().connectTimeout;0<r&&(b.connectTimer=this.setTimeout(function(){h._debug("Transport",f.getType(),"timed out while connecting to URL",c,":",r,"ms");d.call(f,b,{code:1E3,reason:"Connect Timeout"})},r));var g=function(c){c=c||{code:1E3};h._debug("WebSocket onclose",b,c,"connecting",u,"current",t);b.connectTimer&&
f.clearTimeout(b.connectTimer);f.onClose(b,c)};b.webSocket.onopen=function(){h._debug("WebSocket onopen",b);b.connectTimer&&f.clearTimeout(b.connectTimer);b===u||b===t?(u=null,t=b,x=!0,f.onOpen(b)):(h._warn("Closing extra WebSocket connection",this,"active connection",t),d.call(f,b,{code:1E3,reason:"Extra Connection"}))};b.webSocket.onclose=g;b.webSocket.onerror=function(){g({code:1E3,reason:"Error"})};b.webSocket.onmessage=function(c){h._debug("WebSocket onmessage",c,b);f.onMessage(b,c)};this._debug("Transport",
this.getType(),"configured callbacks on",b)}}function f(b,c,e){var f=JSON.stringify(c.messages);b.webSocket.send(f);this._debug("Transport",this.getType(),"sent",c,"/meta/connect =",e);var r=f=this.getConfiguration().maxNetworkDelay;e&&(r+=this.getAdvice().timeout,B=!0);for(var g=this,m=[],l=0;l<c.messages.length;++l)(function(){var e=c.messages[l];e.id&&(m.push(e.id),b.timeouts[e.id]=g.setTimeout(function(){h._debug("Transport",g.getType(),"timing out message",e.id,"after",r,"on",b);d.call(g,b,{code:1E3,
reason:"Message Timeout"})},r))})();this._debug("Transport",this.getType(),"waiting at most",r,"ms for messages",m,"maxNetworkDelay",f,", timeouts:",b.timeouts)}function l(c,g,h){try{null===c?(c=u||{envelopes:{},timeouts:{}},e.call(this,c,g,h),b.call(this,c)):(e.call(this,c,g,h),f.call(this,c,g,h))}catch(S){var r=this;this.setTimeout(function(){d.call(r,c,{code:1E3,reason:"Exception",exception:S})},0)}}var c=new z,g=z.derive(c),h,n=!0,x=!1,m=!0,t=null,u=null,B=!1,y=null;g.reset=function(b){c.reset(b);
n=!0;b&&(x=!1);m=!0;b&&(t=null);u=null;B=!1};g._notifySuccess=function(b,c){b.call(this,c)};g._notifyFailure=function(b,c,d,e){b.call(this,c,d,e)};g.onOpen=function(b){var c=b.envelopes;this._debug("Transport",this.getType(),"opened",b,"pending messages",c);for(var d in c)if(c.hasOwnProperty(d)){var e=c[d],g=e[0];e=e[1];y=g.onSuccess;f.call(this,b,g,e)}};g.onMessage=function(b,c){this._debug("Transport",this.getType(),"received websocket message",c,b);var d=!1;c=this.convertToMessages(c.data);for(var e=
[],f=0;f<c.length;++f){var g=c[f];if((/^\/meta\//.test(g.channel)||void 0===g.data)&&g.id){e.push(g.id);var h=b.timeouts[g.id];h&&(this.clearTimeout(h),delete b.timeouts[g.id],this._debug("Transport",this.getType(),"removed timeout for message",g.id,", timeouts",b.timeouts))}"/meta/connect"===g.channel&&(B=!1);"/meta/disconnect"!==g.channel||B||(d=!0)}f=!1;g=b.envelopes;for(h=0;h<e.length;++h){var m=e[h],l;for(l in g)if(g.hasOwnProperty(l)){var r=l.split(","),n=q.inArray(m,r);if(0<=n){f=!0;r.splice(n,
1);m=g[l][0];n=g[l][1];delete g[l];0<r.length&&(g[r.join(",")]=[m,n]);break}}}f&&this._debug("Transport",this.getType(),"removed envelope, envelopes",g);this._notifySuccess(y,c);d&&this.webSocketClose(b,1E3,"Disconnect")};g.onClose=function(b,c){this._debug("Transport",this.getType(),"closed",b,c);if(b===u||b===t)n=m&&x,t=u=null;var d=b.timeouts;b.timeouts={};for(var e in d)d.hasOwnProperty(e)&&this.clearTimeout(d[e]);d=b.envelopes;b.envelopes={};for(var f in d)if(d.hasOwnProperty(f)){e=d[f][0];d[f][1]&&
(B=!1);var g={websocketCode:c.code,reason:c.reason};c.exception&&(g.exception=c.exception);this._notifyFailure(e.onFailure,b,e.messages,g)}};g.registered=function(b,d){c.registered(b,d);h=d};g.accept=function(b,c,d){this._debug("Transport",this.getType(),"accept, supported:",n);return n&&!!window.WebSocket&&!1!==h.websocketEnabled};g.send=function(b,c){this._debug("Transport",this.getType(),"sending",b,"/meta/connect =",c);l.call(this,t,b,c)};g.webSocketClose=function(b,c,d){try{b.webSocket&&b.webSocket.close(c,
d)}catch(ba){this._debug(ba)}};g.abort=function(){c.abort();d.call(this,t,{code:1E3,reason:"Abort"});this.reset(!0)};return g},T="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),ha=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(d){function e(a,
b){try{return a[b]}catch(J){}}function b(a){return void 0===a||null===a?!1:"function"===typeof a}function f(a,b){for(var p="";0<--b&&!(a>=Math.pow(10,b));)p+="0";return p+a}function A(a,p){if(window.console&&(a=window.console[a],b(a))){var c=new Date;[].splice.call(p,0,0,f(c.getHours(),2)+":"+f(c.getMinutes(),2)+":"+f(c.getSeconds(),2)+"."+f(c.getMilliseconds(),3));a.apply(window.console,p)}}function c(a){return/(^https?:\/\/)?(((\[[^\]]+])|([^:/?#]+))(:(\d+))?)?([^?#]*)(.*)?/.exec(a)}function g(a){k._debug("Configuring cometd object with",
a);q.isString(a)&&(a={url:a});a||(a={});w=k._mixin(!1,w,a);a=k.getURL();if(!a)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var b=c(a);a=b[8];var d=b[9];ca=k._isCrossDomain(b[2]);w.appendMessageTypeToURL&&(void 0!==d&&0<d.length?(k._info("Appending message type to URI "+a+d+" is not supported, disabling 'appendMessageTypeToURL' configuration"),w.appendMessageTypeToURL=!1):(b=a.split("/"),d=b.length-1,a.match(/\/$/)&&--d,0<=b[d].indexOf(".")&&(k._info("Appending message type to URI "+
a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),w.appendMessageTypeToURL=!1)));if(window.Worker&&window.Blob&&window.URL&&w.useWorkerScheduler){a=l.toString();a=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"));a=new window.Blob([a],{type:"application/json"});a=window.URL.createObjectURL(a);var e=new window.Worker(a);O.setTimeout=function(a,b){a=O.register(a);e.postMessage({id:a,type:"setTimeout",delay:b});return a};O.clearTimeout=function(a){O.unregister(a);e.postMessage({id:a,
type:"clearTimeout"})};e.onmessage=function(a){(a=O.unregister(a.data.id))&&a()}}}function h(a){if(a){var b=H[a.channel];b&&b[a.id]&&(delete b[a.id],k._debug("Removed",a.listener?"listener":"subscription",a))}}function n(){for(var a in H)if(H.hasOwnProperty(a)){var b=H[a];if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&!d.listener&&h(d)}}}function x(a){N!==a&&(k._debug("Status",N,"->",a),N=a)}function m(){return"disconnecting"===N||"disconnected"===N}function t(a,c,d,e,f){try{return c.call(a,
e)}catch(P){a=k.onExtensionException;if(b(a)){k._debug("Invoking extension exception handler",d,P);try{a.call(k,P,d,f,e)}catch(ia){k._info("Exception during execution of extension exception handler",d,ia)}}else k._info("Exception during execution of extension",d,P);return e}}function z(a){for(var c=D.length-1;0<=c&&void 0!==a&&null!==a;--c){var d=D[c],e=d.extension.outgoing;b(e)&&(d=t(d.extension,e,d.name,a,!0),a=void 0===d?a:d)}return a}function G(a,c){if(a=H[a])for(var p in a)if(a.hasOwnProperty(p)){var d=
a[p];if(d)try{d.callback.call(d.scope,c)}catch(P){var e=k.onListenerException;if(b(e)){k._debug("Invoking listener exception handler",d,P);try{e.call(k,P,d,d.listener,c)}catch(ia){k._info("Exception during execution of listener exception handler",d,ia)}}else k._info("Exception during execution of listener",d,c,P)}}}function y(a,b){G(a,b);a=a.split("/");for(var c=a.length-1,d=c;0<d;--d){var p=a.slice(0,d).join("/")+"/*";d===c&&G(p,b);p+="*";G(p,b)}}function r(a,b){null!==Q&&k.clearTimeout(Q);Q=null;
b=C.interval+b;k._debug("Function scheduled in",b,"ms, interval =",C.interval,"backoff =",E,a);Q=k.setTimeout(a,b)}function L(a,b,c){for(var d=0;d<a.length;++d){var p=a[d],e=p.id;U&&(p.clientId=U);p=z(p);void 0!==p&&null!==p?(p.id=e,a[d]=p):(delete da[e],a.splice(d--,1))}0!==a.length&&(b&&(Y=a[0]),d=k.getURL(),w.appendMessageTypeToURL&&(d.match(/\/$/)||(d+="/"),c&&(d+=c)),a={url:d,sync:!1,messages:a,onSuccess:function(a){try{Ka.call(k,a)}catch(La){k._info("Exception during handling of messages",La)}},
onFailure:function(a,b,c){try{var d=k.getTransport();c.connectionType=d?d.getType():"unknown";ta.call(k,a,b,c)}catch(Ma){k._info("Exception during handling of failure",Ma)}}},k._debug("Send",a),v.send(a,b))}function X(a){0<K||!0===Z?V.push(a):L([a],!1)}function ba(){var a=V;V=[];0<a.length&&L(a,!1)}function S(a){x("connecting");r(function(){if(!m()){var a={id:""+ ++R,channel:"/meta/connect",connectionType:v.getType()};ea||(a.advice={timeout:0});x("connecting");k._debug("Connect sent",a);L([a],!0,
"connect");x("connected")}},a)}function T(a){a&&(C=k._mixin(!1,{},w.advice,a),k._debug("New advice",C))}function M(a){null!==Q&&k.clearTimeout(Q);Q=null;a&&v&&v.abort();ca=!1;v=null;x("disconnected");U=null;E=K=0;ea=ja=!1;aa=0;Y=null;0<V.length&&(a=V,V=[],ta.call(k,void 0,a,{reason:"Disconnected"}))}function fa(a,c,d){var p=k.onTransportException;if(b(p)){k._debug("Invoking transport exception handler",a,c,d);try{p.call(k,d,a,c)}catch(Ja){k._info("Exception during execution of transport exception handler",
Ja)}}}function qa(a,c){b(a)&&(c=a,a=void 0);U=null;n();m()&&F.reset(!0);T({});K=0;Z=!0;ka=a;ua=c;a=k.getURL();var d=F.findTransportTypes("1.0",ca,a),p={id:""+ ++R,version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:d,advice:{timeout:C.timeout,interval:C.interval}};p=k._mixin(!1,{},ka,p);k._putCallback(p.id,c);if(!v&&(v=F.negotiateTransport(d,"1.0",ca,a),!v))throw c="Could not find initial transport among: "+F.getTransportTypes(),k._warn(c),c;k._debug("Initial transport is",
v.getType());x("handshaking");k._debug("Handshake sent",p);L([p],!1,"handshake")}function ha(a){x("handshaking");Z=!0;r(function(){qa(ka,ua)},a)}function ra(a,c){try{a.call(k,c)}catch(J){if(a=k.onCallbackException,b(a)){k._debug("Invoking callback exception handler",J);try{a.call(k,J,c)}catch(Ia){k._info("Exception during execution of callback exception handler",Ia)}}else k._info("Exception during execution of message callback",J)}}function I(a){var c=k._getCallback([a.id]);b(c)&&(delete da[a.id],
ra(c,a))}function va(a){var c=la[a.id];delete la[a.id];if(c){k._debug("Handling remote call response for",a,"with context",c);var d=c.timeout;d&&k.clearTimeout(d);c=c.callback;if(b(c))return ra(c,a),!0}return!1}function wa(a){k._debug("Transport failure handling",a);a.transport&&(v=a.transport);a.url&&v.setURL(a.url);var b=a.action;a=a.delay||0;switch(b){case "handshake":ha(a);break;case "retry":S(a);break;case "none":M(!0);break;default:throw"Unknown action "+b;}}function ma(a,b){I(a);y("/meta/handshake",
a);y("/meta/unsuccessful",a);m()&&(b.action="none");k.onTransportFailure.call(k,a,b,wa)}function xa(a){return"disconnected"===N?!0:Y&&Y.id===a.id?(Y=null,!0):!1}function ya(a,b){y("/meta/connect",a);y("/meta/unsuccessful",a);m()&&(b.action="none");k.onTransportFailure.call(k,a,b,wa)}function za(a){M(!0);I(a);y("/meta/disconnect",a);y("/meta/unsuccessful",a)}function Aa(a){var b=H[a.subscription];if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d&&!d.listener&&(delete b[c],k._debug("Removed failed subscription",
d))}I(a);y("/meta/subscribe",a);y("/meta/unsuccessful",a)}function Ba(a){I(a);y("/meta/unsubscribe",a);y("/meta/unsuccessful",a)}function na(a){va(a)||(I(a),y("/meta/publish",a),y("/meta/unsuccessful",a))}function Ca(a){for(var d=aa=0;d<D.length&&void 0!==a&&null!==a;++d){var e=D[d],f=e.extension.incoming;b(f)&&(e=t(e.extension,f,e.name,a,!1),a=void 0===e?a:e)}if(void 0!==a&&null!==a)switch(T(a.advice),a.channel){case "/meta/handshake":d=k.getURL();if(a.successful)if(e=k._isCrossDomain(c(d)[2]),d=
F.negotiateTransport(a.supportedConnectionTypes,a.version,e,d),null===d)a.successful=!1,ma(a,{cause:"negotiation",action:"none",transport:null});else switch(v!==d&&(k._debug("Transport",v.getType(),"->",d.getType()),v=d),U=a.clientId,Z=!1,ba(),a.reestablish=ja,ja=!0,I(a),y("/meta/handshake",a),W=a["x-messages"]||0,a=m()?"none":C.reconnect||"retry",a){case "retry":E=0;0===W?S(0):k._debug("Processing",W,"handshake-delivered messages");break;case "none":M(!0);break;default:throw"Unrecognized advice action "+
a;}else ma(a,{cause:"unsuccessful",action:C.reconnect||"handshake",transport:v});break;case "/meta/connect":if(xa(a))if(ea=a.successful)switch(y("/meta/connect",a),a=m()?"none":C.reconnect||"retry",a){case "retry":E=0;S(E);break;case "none":M(!1);break;default:throw"Unrecognized advice action "+a;}else ya(a,{cause:"unsuccessful",action:C.reconnect||"retry",transport:v});else k._debug("Mismatched /meta/connect reply",a);break;case "/meta/disconnect":a.successful?(M(!1),I(a),y("/meta/disconnect",a)):
za(a);break;case "/meta/subscribe":a.successful?(I(a),y("/meta/subscribe",a)):Aa(a);break;case "/meta/unsubscribe":a.successful?(I(a),y("/meta/unsubscribe",a)):Ba(a);break;default:void 0!==a.data?va(a)||(y(a.channel,a),0<W&&(--W,0===W&&(k._debug("Processed last handshake-delivered message"),S(0)))):void 0===a.successful?k._warn("Unknown Bayeux Message",a):a.successful?(I(a),y("/meta/publish",a)):na(a)}}function Da(a){if(a=H[a])for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!0;return!1}function Ea(a,
c){var d={scope:a,method:c};if(b(a))d.scope=void 0,d.method=a;else if(q.isString(c)){if(!a)throw"Invalid scope "+a;d.method=a[c];if(!b(d.method))throw"Invalid callback "+c+" for scope "+a;}else if(!b(c))throw"Invalid callback "+c;return d}function Fa(a,b,c,d){c=Ea(b,c);k._debug("Adding",d?"listener":"subscription","on",a,"with scope",c.scope,"and callback",c.method);b=++Na;c={id:b,channel:a,scope:c.scope,callback:c.method,listener:d};var e=H[a];e||(e={},H[a]=e);e[b]=c;k._debug("Added",d?"listener":
"subscription",c);return c}var O=new u,k=this,Oa=d||"default",ca=!1,F=new B,v,N="disconnected",R=0,U=null,K=0,V=[],Z=!1,Na=0,H={},E=0,Q=null,D=[],C={},ka,ua,da={},la={},ja=!1,ea=!1,aa=0,W=0,Y=null,w={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1E3,maxBackoff:6E4,logLevel:"info",maxNetworkDelay:1E4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2E3,advice:{timeout:6E4,interval:0,reconnect:void 0,maxInterval:0}};
this._mixin=function(a,b,c){for(var d=b||{},p=2;p<arguments.length;++p){var f=arguments[p];if(void 0!==f&&null!==f)for(var g in f)if(f.hasOwnProperty(g)){var k=e(f,g),h=e(d,g);k!==b&&void 0!==k&&(d[g]=a&&"object"===typeof k&&null!==k?k instanceof Array?this._mixin(a,h instanceof Array?h:[],k):this._mixin(a,"object"!==typeof h||h instanceof Array?{}:h,k):k)}}return d};this._warn=function(){A("warn",arguments)};this._info=function(){"warn"!==w.logLevel&&A("info",arguments)};this._debug=function(){"debug"===
w.logLevel&&A("debug",arguments)};this._isCrossDomain=function(a){return window.location&&window.location.host&&a?a!==window.location.host:!1};this.send=X;this._getCallback=function(a){return da[a]};this._putCallback=function(a,c){var d=this._getCallback(a);b(c)&&(da[a]=c);return d};this.onTransportFailure=function(a,b,d){this._debug("Transport failure",b,"for",a);var e=this.getTransportRegistry(),f=this.getURL(),p=this._isCrossDomain(c(f)[2]),g=e.findTransportTypes("1.0",p,f);if("none"===b.action)"/meta/handshake"!==
a.channel||b.transport||(a="Could not negotiate transport, client=["+g+"], server=["+a.supportedConnectionTypes+"]",this._warn(a),fa(v.getType(),null,{reason:a,connectionType:v.getType(),transport:v}));else if(b.delay=this.getBackoffPeriod(),"/meta/handshake"===a.channel){if(!b.transport){var h=v?v.getType():null;(e=e.negotiateTransport(g,"1.0",p,f))?(g=e.getType(),this._debug("Transport",h,"->",g),fa(h,g,a.failure),b.action="handshake",b.transport=e):(this._warn("Could not negotiate transport, client=["+
g+"]"),fa(h,null,a.failure),b.action="none")}"none"!==b.action&&this.increaseBackoffPeriod()}else a=(new Date).getTime(),0===aa&&(aa=a),"retry"===b.action&&(b.delay=this.increaseBackoffPeriod(),h=C.maxInterval,0<h&&a-aa+E>C.timeout+C.interval+h&&(b.action="handshake")),"handshake"===b.action&&(b.delay=0,e.reset(!1),this.resetBackoffPeriod());d.call(k,b)};this.receive=Ca;var Ka=function(a){k._debug("Received",a);for(var b=0;b<a.length;++b)Ca(a[b])};var ta=function(a,b,c){k._debug("handleFailure",a,
b,c);c.transport=a;for(a=0;a<b.length;++a){var d=b[a],e={id:d.id,successful:!1,channel:d.channel,failure:c};c.message=d;switch(d.channel){case "/meta/handshake":ma(e,{cause:"failure",action:"handshake",transport:null});break;case "/meta/connect":d=e;xa(d)?(ea=!1,ya(d,{cause:"failure",action:"retry",transport:null})):k._debug("Mismatched /meta/connect failure",d);break;case "/meta/disconnect":za(e);break;case "/meta/subscribe":e.subscription=d.subscription;Aa(e);break;case "/meta/unsubscribe":e.subscription=
d.subscription;Ba(e);break;default:na(e)}}};this.registerTransport=function(a,c,d){if(d=F.add(a,c,d))this._debug("Registered transport",a),b(c.registered)&&c.registered(a,this);return d};this.unregisterTransport=function(a){var c=F.remove(a);null!==c&&(this._debug("Unregistered transport",a),b(c.unregistered)&&c.unregistered());return c};this.unregisterTransports=function(){F.clear()};this.getTransportTypes=function(){return F.getTransportTypes()};this.findTransport=function(a){return F.find(a)};
this.getTransportRegistry=function(){return F};this.configure=function(a){g.call(this,a)};this.init=function(a,b){this.configure(a);this.handshake(b)};this.handshake=function(a,b){if("disconnected"!==N)throw"Illegal state: handshaken";qa(a,b)};this.disconnect=function(a,c){if(!m()){b(a)&&(c=a,a=void 0);var d={id:""+ ++R,channel:"/meta/disconnect"};a=this._mixin(!1,{},a,d);k._putCallback(a.id,c);x("disconnecting");L([a],!1,"disconnect")}};this.startBatch=function(){++K;k._debug("Starting batch, depth",
K)};this.endBatch=function(){--K;k._debug("Ending batch, depth",K);if(0>K)throw"Calls to startBatch() and endBatch() are not paired";0!==K||m()||Z||ba()};this.batch=function(a,b){a=Ea(a,b);this.startBatch();try{a.method.call(a.scope),this.endBatch()}catch(J){throw this._info("Exception during execution of batch",J),this.endBatch(),J;}};this.addListener=function(a,b,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";
return Fa(a,b,c,!0)};this.removeListener=function(a){if(!(a&&a.channel&&"id"in a))throw"Invalid argument: expected subscription, not "+a;h(a)};this.clearListeners=function(){H={}};this.subscribe=function(a,c,d,e,f){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";if(m())throw"Illegal state: disconnected";b(c)&&(f=e,e=d,d=c,c=void 0);b(e)&&(f=e,e=void 0);var g=!Da(a),h=Fa(a,c,d,!1);g&&(g=
{id:""+ ++R,channel:"/meta/subscribe",subscription:a},g=this._mixin(!1,{},e,g),k._putCallback(g.id,f),X(g));return h};this.unsubscribe=function(a,c,d){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(m())throw"Illegal state: disconnected";b(c)&&(d=c,c=void 0);this.removeListener(a);var e=a.channel;Da(e)||(e={id:""+ ++R,channel:"/meta/unsubscribe",subscription:e},e=this._mixin(!1,{},c,e),k._putCallback(e.id,d),X(e))};this.resubscribe=function(a,b){a&&!a.listener&&
h(a);if(a)return this.subscribe(a.channel,a.scope,a.callback,b)};this.clearSubscriptions=function(){n()};this.publish=function(a,c,d,e){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(a))throw"Illegal argument: cannot publish to meta channels";if(m())throw"Illegal state: disconnected";b(c)?(e=c,c={},d=void 0):b(d)&&(e=d,d=void 0);var f={id:""+ ++R,channel:a,data:c};
f=this._mixin(!1,{},d,f);k._putCallback(f.id,e);X(f)};this.publishBinary=function(a,c,d,e,f){b(c)?(f=c,c=new ArrayBuffer(0),d=!0,e=void 0):b(d)?(f=d,d=!0,e=void 0):b(e)&&(f=e,e=void 0);this.publish(a,{meta:e,data:c,last:d},{ext:{binary:{}}},f)};this.remoteCall=function(a,c,d,e,f){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: target must be a string";if(m())throw"Illegal state: disconnected";b(c)?(f=c,c={},d=
w.maxNetworkDelay,e=void 0):b(d)?(f=d,d=w.maxNetworkDelay,e=void 0):b(e)&&(f=e,e=void 0);if("number"!==typeof d)throw"Illegal argument type: timeout must be a number";a.match(/^\//)||(a="/"+a);var g={id:""+ ++R,channel:"/service"+a,data:c},h=this._mixin(!1,{},e,g);g={callback:f};0<d&&(g.timeout=k.setTimeout(function(){k._debug("Timing out remote call",h,"after",d,"ms");na({id:h.id,error:"406::timeout",successful:!1,failure:{message:h,reason:"Remote Call Timeout"}})},d),k._debug("Scheduled remote call timeout",
h,"in",d,"ms"));la[h.id]=g;X(h)};this.remoteCallBinary=function(a,c,d,e,f,g){b(c)?(g=c,c=new ArrayBuffer(0),d=!0,e=void 0,f=w.maxNetworkDelay):b(d)?(g=d,d=!0,e=void 0,f=w.maxNetworkDelay):b(e)?(g=e,e=void 0,f=w.maxNetworkDelay):b(f)&&(g=f,f=w.maxNetworkDelay);this.remoteCall(a,{meta:e,data:c,last:d},f,{ext:{binary:{}}},g)};this.getStatus=function(){return N};this.isDisconnected=m;this.setBackoffIncrement=function(a){w.backoffIncrement=a};this.getBackoffIncrement=function(){return w.backoffIncrement};
this.getBackoffPeriod=function(){return E};this.increaseBackoffPeriod=function(){E<w.maxBackoff&&(E+=w.backoffIncrement);return E};this.resetBackoffPeriod=function(){E=0};this.setLogLevel=function(a){w.logLevel=a};this.registerExtension=function(a,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!q.isString(a))throw"Illegal argument type: extension name must be a string";for(var d=!1,e=0;e<D.length;++e)if(D[e].name===a){d=!0;break}if(d)return this._info("Could not register extension with name",
a,"since another extension with the same name already exists"),!1;D.push({name:a,extension:c});this._debug("Registered extension",a);b(c.registered)&&c.registered(a,this);return!0};this.unregisterExtension=function(a){if(!q.isString(a))throw"Illegal argument type: extension name must be a string";for(var c=!1,d=0;d<D.length;++d){var e=D[d];if(e.name===a){D.splice(d,1);c=!0;this._debug("Unregistered extension",a);a=e.extension;b(a.unregistered)&&a.unregistered();break}}return c};this.getExtension=
function(a){for(var b=0;b<D.length;++b){var c=D[b];if(c.name===a)return c.extension}return null};this.getName=function(){return Oa};this.getClientId=function(){return U};this.getURL=function(){if(v){var a=v.getURL();if(a||(a=w.urls[v.getType()]))return a}return w.url};this.getTransport=function(){return v};this.getConfiguration=function(){return this._mixin(!0,{},w)};this.getAdvice=function(){return this._mixin(!0,{},C)};this.setTimeout=function(a,b){return O.setTimeout(function(){try{k._debug("Invoking timed function",
a),a()}catch(J){k._debug("Exception invoking timed function",a,J)}},b)};this.clearTimeout=function(a){O.clearTimeout(a)};window.WebSocket&&this.registerTransport("websocket",new sa);this.registerTransport("long-polling",new oa);this.registerTransport("callback-polling",new pa)},Transport:z,RequestTransport:G,LongPollingTransport:oa,CallbackPollingTransport:pa,WebSocketTransport:sa,Utils:q,Z85:{encode:function(d){var e=null;d instanceof ArrayBuffer?e=d:d.buffer instanceof ArrayBuffer?e=d.buffer:Array.isArray(d)&&
(e=(new Uint8Array(d)).buffer);if(null==e)throw"Cannot Z85 encode "+d;d=e.byteLength;var b=d%4;b=4-(0===b?4:b);e=new DataView(e);for(var f="",l=0,c=0;c<d+b;++c){var g=c>=d;l=256*l+(g?0:e.getUint8(c));if(0===(c+1)%4){for(var h=52200625,n=5;0<n;--n){if(!g||n>b)f+=T[Math.floor(l/h)%85];h/=85}l=0}}return f},decode:function(d){var e=d.length%5,b=5-(0===e?5:e);for(e=0;e<b;++e)d+=T[T.length-1];e=d.length;b=new ArrayBuffer(4*e/5-b);for(var f=new DataView(b),l=0,c=0,g=0,h=0;h<e;++h){var n=d.charCodeAt(c++)-
32;l=85*l+ha[n];if(0===c%5){for(n=16777216;1<=n;)g<f.byteLength&&f.setUint8(g++,Math.floor(l/n)%256),n/=256;l=0}}return b}}}});
